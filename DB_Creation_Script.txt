# Script to Create The Smart Report DataBase
# Version 2.5.0
# Creating Date 04/08/2021
# Last Updated On 

DROP TABLE IF EXISTS USER_NEWS;
DROP TABLE IF EXISTS TOKEN;
DROP TABLE IF EXISTS USER;
DROP TABLE IF EXISTS NEWS;

CREATE TABLE USER (
user_id INT NOT NULL AUTO_INCREMENT,
email TEXT NOT NULL,
hash TEXT NOT NULL,
salt TEXT NOT NULL,
email_freq INT NOT NULL DEFAULT 7,
CONSTRAINT unique_email UNIQUE (email(100)),
PRIMARY KEY (user_id)
) ENGINE = InnoDB;

CREATE TABLE NEWS (
news_id INT NOT NULL AUTO_INCREMENT,
rss_feed TEXT NOT NULL,
CONSTRAINT unique_rss_feed UNIQUE (rss_feed(100)),
PRIMARY KEY (news_id)
) ENGINE = InnoDB;

# ---------------------- Many (USER) to Many (NEWS)
CREATE TABLE USER_NEWS (
user_id INT NOT NULL,
news_id INT NOT NULL,
primary key (user_id, news_id),
CONSTRAINT fk1_USER_NEWS FOREIGN KEY (user_id) REFERENCES USER(user_id) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT fk2_USER_NEWS FOREIGN KEY (news_id) REFERENCES NEWS(news_id) ON UPDATE CASCADE ON DELETE CASCADE
) ENGINE = InnoDB;

# --------------------- One (USER) to Many (TOKEN)
CREATE TABLE TOKEN (
token_id INT NOT NULL AUTO_INCREMENT,
token TEXT NOT NULL,
user_id INT NOT NULL,
CONSTRAINT fk1_USER_TOKEN FOREIGN KEY (user_id) REFERENCES USER (user_id) ON UPDATE CASCADE ON DELETE CASCADE,
PRIMARY KEY (token_id)
) ENGINE = InnoDB;

# SET FOREIGN_KEY_CHECKS=0;



